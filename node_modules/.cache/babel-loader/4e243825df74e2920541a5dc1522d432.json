{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\Repositories\\\\starter-app\\\\src\\\\app\\\\auth\\\\login\\\\login.container.js\";\nimport React from 'react';\nimport TextField from '@material-ui/core/TextField';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport AccountCircle from '@material-ui/icons/AccountCircle';\nimport Lock from '@material-ui/icons/Lock';\nimport Card from '@material-ui/core/Card';\nimport Button from '@material-ui/core/Button';\nimport Redirect from 'react-router-dom/Redirect';\nimport Typography from '@material-ui/core/Typography';\nimport axios from 'axios';\nimport { getAuthorizationHeader, handleLogout, SERVER_API_URL } from '../../shared/app.properties';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport MySnackbarContent from '../../shared/SnackbarContentWrapper';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nvar LoginContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LoginContainer, _React$Component);\n\n  function LoginContainer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, LoginContainer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(LoginContainer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      username: '',\n      password: '',\n      shakeClass: '',\n      redirect: false,\n      snackbarOpen: false,\n      snackbarMessage: '',\n      fieldUsernameError: false,\n      messageVariant: 'error',\n      fieldPasswordError: false\n    };\n\n    _this.authenticate = function () {\n      _this.setState({\n        shakeClass: '',\n        snackbarOpen: false,\n        loading: true\n      });\n\n      var username = _this.state.username;\n      var password = _this.state.password;\n      var goterr = false;\n\n      if (username == undefined || username == '' || username == ' ') {\n        _this.setState({\n          fieldUsernameError: true,\n          snackbarOpen: true,\n          loading: false,\n          snackbarMessage: 'Some required fields are empty!'\n        });\n\n        goterr = true;\n      } else {\n        _this.setState({\n          fieldUsernameError: false\n        });\n      }\n\n      if (password == undefined || password == '' || password == '') {\n        _this.setState({\n          fieldPasswordError: true,\n          snackbarOpen: true,\n          loading: false,\n          snackbarMessage: 'Some required fields are empty!'\n        });\n\n        goterr = true;\n      } else {\n        _this.setState({\n          fieldPasswordError: false\n        });\n      }\n\n      if (goterr) return;\n      axios({\n        url: SERVER_API_URL + '/oauth/token?username=' + username + '&password=' + password + '&grant_type=password',\n        method: 'POST',\n        headers: {\n          'Authorization': getAuthorizationHeader()\n        }\n      }).then(function (res) {\n        _this.handleAuthSuccess(res);\n      }).catch(function (err) {\n        _this.handleAuthError(err);\n      });\n    };\n\n    _this.handleAuthSuccess = function (res) {\n      _this.setState({\n        messageVariant: 'success',\n        snackbarMessage: '',\n        shakeClass: '',\n        snackbarOpen: false,\n        loading: false\n      });\n\n      var expires_at_date = new Date(); // expires_at_date.setSeconds(expires_at_date.getSeconds() + res.data.expires_in);\n\n      expires_at_date = new Date(expires_at_date.getTime() + res.data.expires_in * 1000);\n      res.data.expires_at = expires_at_date;\n      res.data.username = _this.state.username;\n      localStorage.setItem('idm', JSON.stringify(res.data));\n      axios({\n        url: SERVER_API_URL + '/users/me?access_token=' + res.data.access_token,\n        method: 'GET',\n        headers: {\n          'Authorization': 'Basic bXktdHJ1c3RlZC1jbGllbnQ6c2VjcmV0'\n        }\n      }).then(function (response) {\n        localStorage.setItem('me', JSON.stringify(response.data));\n\n        _this.setState({\n          logedin: true\n        });\n      }).catch(function (err) {});\n    };\n\n    _this.handleAuthError = function (err) {\n      _this.setState({\n        snackbarOpen: true,\n        messageVariant: 'error',\n        snackbarMessage: 'Wrong credentials',\n        shakeClass: 'apply-shake',\n        loading: false\n      });\n    };\n\n    _this.handleCloseSnackbar = function () {\n      _this.setState({\n        snackbarOpen: false\n      });\n    };\n\n    _this.handleFormChange = function (name) {\n      return function (event) {\n        var val = event.target.value;\n\n        _this.setState(_defineProperty({}, name, val));\n      };\n    };\n\n    return _this;\n  }\n\n  _createClass(LoginContainer, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var refreshTime = new Date();\n      refreshTime.setSeconds(refreshTime.getSeconds() + 1800); // if (!localStorage.getItem('idm') || !localStorage.getItem('me')) {\n      //     handleLogout()\n      // } else if (localStorage.getItem('idm') && new Date(JSON.parse(localStorage.getItem('idm')).expires_at) < new Date()) {\n      //     handleLogout()\n      // }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var idm = localStorage.getItem('idm');\n      idm = JSON.parse(localStorage.getItem('idm'));\n\n      if (idm && idm.access_token !== undefined) {\n        // refreshToken();\n        if (idm.expires_at <= 300) {}\n      }\n    }\n  }, {\n    key: \"enterPressed\",\n    value: function enterPressed(event) {\n      var code = event.keyCode || event.which;\n\n      if (code === 13) {\n        //13 is the enter keycode\n        this.authenticate();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, localStorage.getItem('idm') && React.createElement(Redirect, {\n        to: \"/app/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }), this.logedin && React.createElement(Redirect, {\n        to: \"/app/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }), React.createElement(Card, {\n        className: this.state.shakeClass,\n        style: {\n          width: 600 + \"px\",\n          padding: 15 + \"px\",\n          marginLeft: \"auto\",\n          marginRight: \"auto\",\n          marginTop: 10 + \"%\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        variant: \"h5\",\n        style: {\n          marginBottom: 20 + \"px\",\n          textAlign: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, \"Log in\"), React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        id: \"input-username\",\n        onKeyPress: this.enterPressed.bind(this),\n        label: \"Username\",\n        fullWidth: true,\n        onChange: this.handleFormChange('username'),\n        error: this.state.fieldUsernameError,\n        value: this.state.username,\n        InputProps: {\n          startAdornment: React.createElement(InputAdornment, {\n            position: \"start\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 192\n            },\n            __self: this\n          }, React.createElement(AccountCircle, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 193\n            },\n            __self: this\n          }))\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }), React.createElement(TextField, {\n        id: \"input-password\",\n        onKeyPress: this.enterPressed.bind(this),\n        label: \"Password\",\n        type: \"password\",\n        onChange: this.handleFormChange('password'),\n        value: this.state.password,\n        error: this.state.fieldPasswordError,\n        fullWidth: true,\n        InputProps: {\n          startAdornment: React.createElement(InputAdornment, {\n            position: \"start\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 211\n            },\n            __self: this\n          }, React.createElement(Lock, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 212\n            },\n            __self: this\n          }))\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }), React.createElement(Button, {\n        onClick: this.authenticate,\n        color: \"primary\",\n        fullWidth: true,\n        variant: \"contained\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, !this.state.loading && 'Login', this.state.loading && React.createElement(CircularProgress, {\n        style: {\n          color: 'white'\n        },\n        size: 24,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      })))), React.createElement(Snackbar, {\n        width: 600 + 'px',\n        anchorOrigin: {\n          vertical: 'top',\n          horizontal: 'center'\n        },\n        onClose: this.handleCloseSnackbar,\n        open: this.state.snackbarOpen,\n        variant: this.state.messageVariant,\n        autoHideDuration: 6000,\n        ContentProps: {\n          'aria-describedby': 'message-id'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(MySnackbarContent, {\n        onClose: this.handleCloseSnackbar,\n        variant: this.state.messageVariant,\n        message: this.state.snackbarMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return LoginContainer;\n}(React.Component);\n\nexport { LoginContainer as default };","map":{"version":3,"sources":["C:/Users/user/Desktop/Repositories/starter-app/src/app/auth/login/login.container.js"],"names":["React","TextField","InputAdornment","AccountCircle","Lock","Card","Button","Redirect","Typography","axios","getAuthorizationHeader","handleLogout","SERVER_API_URL","Snackbar","MySnackbarContent","CircularProgress","LoginContainer","state","username","password","shakeClass","redirect","snackbarOpen","snackbarMessage","fieldUsernameError","messageVariant","fieldPasswordError","authenticate","setState","loading","goterr","undefined","url","method","headers","then","res","handleAuthSuccess","catch","err","handleAuthError","expires_at_date","Date","getTime","data","expires_in","expires_at","localStorage","setItem","JSON","stringify","access_token","response","logedin","handleCloseSnackbar","handleFormChange","name","event","val","target","value","refreshTime","setSeconds","getSeconds","idm","getItem","parse","code","keyCode","which","width","padding","marginLeft","marginRight","marginTop","marginBottom","textAlign","enterPressed","bind","startAdornment","color","vertical","horizontal","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport AccountCircle from '@material-ui/icons/AccountCircle';\r\nimport Lock from '@material-ui/icons/Lock';\r\nimport Card from '@material-ui/core/Card';\r\nimport Button from '@material-ui/core/Button';\r\nimport Redirect from 'react-router-dom/Redirect'\r\nimport Typography from '@material-ui/core/Typography';\r\nimport axios from 'axios';\r\nimport {getAuthorizationHeader, handleLogout, SERVER_API_URL} from '../../shared/app.properties';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport MySnackbarContent from '../../shared/SnackbarContentWrapper';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\n\r\nexport default class LoginContainer extends React.Component {\r\n\r\n    username;\r\n    password;\r\n\r\n    state = {\r\n        username: '',\r\n        password: '',\r\n        shakeClass: '',\r\n        redirect: false,\r\n        snackbarOpen: false,\r\n        snackbarMessage: '',\r\n        fieldUsernameError: false,\r\n        messageVariant: 'error',\r\n        fieldPasswordError: false\r\n    }\r\n\r\n    componentWillMount() {\r\n        let refreshTime = new Date();\r\n        refreshTime.setSeconds(refreshTime.getSeconds() + 1800);\r\n\r\n        // if (!localStorage.getItem('idm') || !localStorage.getItem('me')) {\r\n        //     handleLogout()\r\n        // } else if (localStorage.getItem('idm') && new Date(JSON.parse(localStorage.getItem('idm')).expires_at) < new Date()) {\r\n        //     handleLogout()\r\n        // }\r\n    }\r\n\r\n    componentDidMount(){\r\n        var idm = localStorage.getItem('idm');\r\n        idm = JSON.parse(localStorage.getItem('idm'));\r\n        if(idm && idm.access_token !== undefined){\r\n            // refreshToken();\r\n            if(idm.expires_at <= 300){\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    enterPressed(event) {\r\n        var code = event.keyCode || event.which;\r\n        if(code === 13) { //13 is the enter keycode\r\n           this.authenticate();\r\n        } \r\n    }\r\n\r\n    authenticate = () => {\r\n        this.setState({shakeClass: '', snackbarOpen: false, loading: true});\r\n        let username = this.state.username;\r\n        let password = this.state.password;\r\n\r\n\r\n        let goterr = false;\r\n        if(username == undefined || username == '' || username == ' '){\r\n            this.setState({fieldUsernameError: true, \r\n                snackbarOpen: true,\r\n                loading: false,\r\n                snackbarMessage: 'Some required fields are empty!'});\r\n            goterr = true;\r\n        }else{\r\n            this.setState({fieldUsernameError: false});\r\n        }\r\n        if(password == undefined || password == '' || password == ''){\r\n            this.setState({fieldPasswordError: true, \r\n                snackbarOpen: true,\r\n                loading: false,\r\n                snackbarMessage: 'Some required fields are empty!'});\r\n            goterr = true;\r\n        }else{\r\n            this.setState({fieldPasswordError: false});\r\n        }\r\n        if(goterr) return;\r\n\r\n        axios({\r\n            url: SERVER_API_URL + '/oauth/token?username='\r\n            + username \r\n            + '&password='\r\n            + password\r\n            + '&grant_type=password',\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization' : getAuthorizationHeader()\r\n            }\r\n        }).then(res => {\r\n            this.handleAuthSuccess(res);\r\n        }).catch(err => {\r\n            this.handleAuthError(err);\r\n        })\r\n    }\r\n\r\n    handleAuthSuccess = res => {\r\n\r\n        this.setState({\r\n            messageVariant: 'success',\r\n            snackbarMessage: '',\r\n            shakeClass: '',\r\n            snackbarOpen: false,\r\n            loading: false\r\n        });\r\n        var expires_at_date = new Date();\r\n        // expires_at_date.setSeconds(expires_at_date.getSeconds() + res.data.expires_in);\r\n        expires_at_date = new Date(expires_at_date.getTime() + res.data.expires_in * 1000);\r\n        res.data.expires_at = expires_at_date;\r\n\r\n\r\n        res.data.username = this.state.username;\r\n        localStorage.setItem('idm', JSON.stringify(res.data));\r\n        \r\n        axios({\r\n            url: SERVER_API_URL + '/users/me?access_token='\r\n            + res.data.access_token, \r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization' : 'Basic bXktdHJ1c3RlZC1jbGllbnQ6c2VjcmV0'\r\n            }\r\n        }).then(response => {\r\n            localStorage.setItem('me', JSON.stringify(response.data));\r\n            this.setState({\r\n                logedin: true\r\n            })\r\n        }).catch(err => {\r\n\r\n\r\n        })\r\n        \r\n        \r\n    }\r\n\r\n\r\n    handleAuthError = err => {\r\n\r\n\r\n        this.setState({\r\n            snackbarOpen: true,\r\n            messageVariant: 'error',\r\n            snackbarMessage: 'Wrong credentials',\r\n            shakeClass: 'apply-shake',\r\n            loading: false\r\n        })\r\n    }\r\n\r\n    handleCloseSnackbar = () =>{\r\n        this.setState({snackbarOpen: false});\r\n    }\r\n\r\n    handleFormChange = name => event => {\r\n        let val = event.target.value;\r\n        this.setState({\r\n         [name]: val\r\n        });\r\n     }; \r\n\r\n  render() {\r\n    return (\r\n        <div>\r\n            {\r\n                localStorage.getItem('idm') && <Redirect to='/app/'/>\r\n            }\r\n            {\r\n                this.logedin && <Redirect to='/app/'/>\r\n            }\r\n            <Card className={this.state.shakeClass} style={{width: 600+\"px\", padding: 15+\"px\", marginLeft: \"auto\", marginRight: \"auto\", marginTop: 10+\"%\"}}>\r\n            \r\n            <Typography variant=\"h5\" style={{marginBottom: 20+\"px\", textAlign: 'center'}} >Log in</Typography>\r\n            <form>\r\n            <TextField\r\n                id=\"input-username\"\r\n                onKeyPress={this.enterPressed.bind(this)}\r\n                label=\"Username\"\r\n                fullWidth={true}\r\n                onChange={this.handleFormChange('username')}\r\n                error={this.state.fieldUsernameError}\r\n                value={this.state.username}\r\n                InputProps={{\r\n                startAdornment: (\r\n                    <InputAdornment position=\"start\">\r\n                    <AccountCircle />\r\n                    </InputAdornment>\r\n                ),\r\n                }}\r\n            />\r\n\r\n            <br/><br/>\r\n                <TextField\r\n                id=\"input-password\"\r\n                onKeyPress={this.enterPressed.bind(this)}\r\n                label=\"Password\"\r\n                type=\"password\"\r\n                onChange={this.handleFormChange('password')}\r\n                value={this.state.password}\r\n                error={this.state.fieldPasswordError}\r\n                fullWidth={true}\r\n                InputProps={{\r\n                startAdornment: (\r\n                    <InputAdornment position=\"start\">\r\n                    <Lock />\r\n                    </InputAdornment>\r\n                ),\r\n                }}\r\n            />\r\n            <br/><br/><br/>\r\n            <Button onClick={this.authenticate} color=\"primary\" fullWidth={true} variant=\"contained\">\r\n                    {!this.state.loading && 'Login' }\r\n                    {this.state.loading && <CircularProgress style={{color: 'white'}} size={24} />}\r\n            </Button>\r\n            </form>\r\n            </Card>\r\n            \r\n\r\n          <Snackbar\r\n            width={600+'px'}\r\n            anchorOrigin={{\r\n              vertical: 'top',\r\n              horizontal: 'center',\r\n            }}\r\n            onClose={this.handleCloseSnackbar}\r\n            open={this.state.snackbarOpen}\r\n            variant={this.state.messageVariant}\r\n            autoHideDuration={6000}\r\n            ContentProps={{\r\n              'aria-describedby': 'message-id',\r\n            }}\r\n          >\r\n            <MySnackbarContent\r\n              onClose={this.handleCloseSnackbar}\r\n              variant={this.state.messageVariant}\r\n              message={this.state.snackbarMessage}\r\n            />\r\n          </Snackbar>\r\n        </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}